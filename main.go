package main

import (
	"github.com/apex/log"
	_ "github.com/lib/pq"
	"github.com/t-bonatti/stock-follower/config"
	"github.com/t-bonatti/stock-follower/database"
	statusinvest "github.com/t-bonatti/stock-follower/statusinvest"

	"time"
)

func main() {
	var cfg = config.Get()
	var now = time.Now()

	var db = database.Connect(cfg.DatabaseURL)
	defer func() {
		if err := db.Close(); err != nil {
			log.WithError(err).Error("failed to close database connections")
		}
	}()

	repo := statusinvest.NewStatusInvestRepository(db)
	craweler := statusinvest.NewCrawler()

	for _, stock := range getStocks() {
		statusInvestData, err := craweler.Get(stock)
		statusInvestData.CrawledAt = now
		if err == nil {
			err2 := repo.Create(statusInvestData)
			if err2 != nil {
				log.WithError(err2).Error("failed to create")
			}
		}
	}

}

func getStocks() [257]string {
	return [257]string{
		"ALPK3",
		"MTRE3",
		"MDNE3",
		"BDLL4",
		"BDLL3",
		"RAPT4",
		"RAPT3",
		"LUPA3",
		"INEP4",
		"INEP3",
		"FRAS3",
		"SHUL4",
		"SHUL3",
		"TASA4",
		"TASA3",
		"GOLL11",
		"GOLL4",
		"ETER3",
		"VLID3",
		"TPIS3",
		"POMO4",
		"POMO3",
		"RLOG3",
		"EALT4",
		"EALT3",
		"ENEV3",
		"WEGE3",
		"RAIL3",
		"VALE3",
		"USIM6",
		"USIM5",
		"USIM3",
		"STBP3",
		"IVPR4B",
		"IVPR3B",
		"LIQO3",
		"RANI3",
		"CCRO3",
		"AZUL4",
		"RDNI3",
		"SLED3",
		"RSID3",
		"MNDL3",
		"LEVE3",
		"CTKA4",
		"CTKA3",
		"MYPK3",
		"GRND3",
		"LCAM3",
		"CEAB3",
		"LLIS3",
		"CGRA4",
		"CGRA3",
		"ESTR4",
		"ESTR3",
		"DIRR3",
		"CTNM4",
		"CTNM3",
		"EVEN3",
		"AMAR3",
		"MOVI3",
		"JHSF3",
		"HBOR3",
		"PDGR3",
		"EZTC3",
		"SMLS3",
		"RENT3",
		"MRVE3",
		"MGLU3",
		"LREN3",
		"COGN3",
		"WHRL4",
		"WHRL3",
		"VVAR3",
		"TCSA3",
		"SEER3",
		"SLED4",
		"LAME4",
		"LAME3",
		"HOOT4",
		"GFSA3",
		"YDUQ3",
		"CYRE3",
		"CVCB3",
		"SMTO3",
		"MDIA3",
		"CAML3",
		"AGRO3",
		"BSEV3",
		"BEEF3",
		"BEEF11",
		"VIVA3",
		"CRFB3",
		"PCAR3",
		"NTCO3",
		"MRFG3",
		"JBSS3",
		"BRFS3",
		"BSLI4",
		"BSLI3",
		"BTTL3",
		"BPAR3",
		"SCAR3",
		"LPSB3",
		"BMGB11",
		"BMGB4",
		"IGBR3",
		"GSHP3",
		"PSSA3",
		"CARD3",
		"BBRK3",
		"BRPR3",
		"BRSR6",
		"BRSR5",
		"BRSR3",
		"BIDI3",
		"BIDI11",
		"BIDI4",
		"SANB4",
		"SANB3",
		"SANB11",
		"MULT3",
		"ITUB4",
		"ITUB3",
		"ALSO3",
		"LOGG3",
		"ITSA4",
		"IRBR3",
		"IGTA3",
		"BBDC4",
		"BBDC3",
		"BRML3",
		"APER3",
		"BBSE3",
		"BPAN4",
		"BBAS3",
		"BBAS12",
		"BBAS11",
		"PMAM3",
		"FESA4",
		"FESA3",
		"EUCA4",
		"EUCA3",
		"SUZB3",
		"KLBN4",
		"KLBN3",
		"KLBN11",
		"VALE5",
		"UNIP6",
		"UNIP5",
		"UNIP3",
		"NEMO6",
		"NEMO5",
		"NEMO3",
		"MMXM3",
		"MMXM11",
		"GOAU4",
		"CSNA3",
		"RANI4",
		"BRKM6",
		"BRKM5",
		"BRKM3",
		"BRAP4",
		"BRAP3",
		"MAPT4",
		"MAPT3",
		"BETP3B",
		"ATOM3",
		"CCXC3",
		"PRIO3",
		"OSXB3",
		"DMMO11",
		"DMMO3",
		"RPMG3",
		"UGPA3",
		"PETR4",
		"PETR3",
		"BRDT3",
		"ENAT3",
		"PARD3",
		"BIOM3",
		"BALM4",
		"BALM3",
		"GBIO33",
		"PNVL4",
		"PNVL3",
		"AALR3",
		"ODPV3",
		"RADL3",
		"QUAL3",
		"OFSA3",
		"HYPE3",
		"FLRY3",
		"LWSA3",
		"TOTS3",
		"LINX3",
		"POSI3",
		"OIBR4",
		"OIBR",
		"TIMP3",
		"VIVT4",
		"VIVT3",
		"TELB4",
		"TELB3",
		"CEPE6",
		"CEPE5",
		"CEPE3",
		"CEED4",
		"CEED3",
		"EEEL4",
		"EEEL3",
		"CASN4",
		"CASN3",
		"CEGR3",
		"CEBR6",
		"CEBR5",
		"CEBR3",
		"RNEW4",
		"RNEW3",
		"COCE6",
		"COCE5",
		"COCE3",
		"CLSC4",
		"CLSC3",
		"ALUP4",
		"ALUP3",
		"ALUP11",
		"SAPR4",
		"SAPR3",
		"SAPR11",
		"CPRE3",
		"CPLE6",
		"CPLE5",
		"CPLE3",
		"CPFE3",
		"CGAS5",
		"CGAS3",
		"TIET4",
		"TIET3",
		"TIET11",
		"NEOE3",
		"TRPL4",
		"TRPL3",
		"EGIE3",
		"TAEE4",
		"TAEE3",
		"TAEE11",
		"SBSP3",
		"RNEW11",
		"GEPA4",
		"GEPA3",
		"CESP6",
		"CESP5",
		"CESP3",
		"CMIG4",
		"CMIG3",
		"AFLT3",
	}
}
